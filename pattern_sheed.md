# 試行リファクタリング

## 状況
混乱したコードがある。テストはない。

## 解きたい問題
ほつれを解きほぐし、理解を素早く積極的に対象のコードの理解を深めたい。

## フォース
　優先順位を付けて、[ステップバイステップ]でちょっとづつ、[仕様化テスト]を書き、[リファクタリング可能エリア]を
カバレッジツールで確認し[リファクタリング]するを繰り返すが、[レガシコード改善／技術的負債の返済]の基本です。

が、混乱したコードを目の前にして、もっと素早く、コードが何をしているのか理解したい、本来の目指すべきリーダブルコードがどのようなものかを知りたい場合があります。このとき、前述のステップバイステップでは時間がかかってしまいます。単なるコードリーディングや、既存コードから図解を行っても、
すでにコードが混乱しており理解はなかなか進まないでしょう。一部には実行されない不要なコードも混ざっており理解の邪魔となるでしょう。

## 解
したがって、[試行ファクタリング]をしよう。コードの学習理解だけを目的として、[試行リファクタリング]しながらコードリーディングしよう。
テストの記述は現状の動きや期待する振る舞いの理解を目的のみの最小限にとどめておこう。
容赦なくリファクタ、本来あるべきであった[リーダブルコード]の形を模索する行為を通じて対象コードの理解を深めよう。
対象ゴードが十分理解ができたら、修正内容はきれいさっぱり捨てよう。必ず捨てよう。
実施する際は、[ペアプログラミング]や複数人でプロジェクターに移しながら[ライブコーディング]を交えて、
現状の理解や理想のコードの形や設計について語り合おう。[ホワイトボード設計]や[設計原則]を活用しながら議論すると理解はさらに深ります。

## 結果状況
ステップバイステップのゆっくりとしたアプローチや、単にリーディングや逆スケッチに比べ、素早く積極的にコードへの理解を深めることができます。
理想的なコードがどのようなものであったかをコードをベースに話すことができます。
(もうちょっと詳しくメリットをアピールしたいところ。)

ただし、通常のレガシーコード改善はもっと[持続可能なペース]で行われるべきものです。このアプローチは危ないショートカット作業です。
試行リファクタリングの理想に描いたコード像に、王道のレガシーコード改善のステップで到達できるとは限りません。
また、試行リファクタリングを通常のリファクタリングやレガシーコード改善と誤解してしまって、コミットししまうと、
既存の期待する振る舞いを破壊してしまい、TDDやリファクタリングについての悪評を生み出す結果を生み出すでしょう。

## 代替案
急がば回れ。急いては事を仕損じる。通常のレガシーコード改善でもいずれは対象コードを理解することは可能です。しかもちゃんと動きます。
既存コードに一時的に何をしているかをコメントで装飾するにとどめ、理解を深める方法もあります。
（装飾コメント、レガシーコード改善の活動の中で消していく）
[仕様化テスト]を使って、内部コードは一旦置いといて、外部から現状の振る舞いをテスト記述を重ねることで理解を深める方法もあります。
[CRCカード]を使ったコラボレーションの再設計や[影響スケッチ]を使って影響範囲を調べることでも対象コードへの理解は可能です。


## メモ
誤解による悪評や、本来の持続可能なペースできれいにしていくレガシーコード改善を考えると、
「試行リファクタリング」にリファクタリングという名前が入っているのは、微妙なのかもね。
